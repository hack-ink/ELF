name: Issue triage label sync

on:
  issues:
    types:
      - opened
      - reopened
      - labeled
      - unlabeled

permissions:
  issues: write

jobs:
  triage:
    runs-on: ubuntu-latest
    steps:
      - name: Sync status:needs-triage label
        uses: actions/github-script@v8
        with:
          script: |
            const issue = context.payload.issue;
            if (!issue || !issue.number) {
              return;
            }

            const labels = (issue.labels || []).map((label) => label.name || "");
            const hasKind = labels.some((name) => name.startsWith("kind:"));
            const hasArea = labels.some((name) => name.startsWith("area:"));
            const needsTriage = !(hasKind && hasArea);
            const triageLabel = "status:needs-triage";
            const hasTriage = labels.includes(triageLabel);

            const params = {
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
            };

            if (needsTriage && !hasTriage) {
              await github.rest.issues.addLabels({
                ...params,
                labels: [triageLabel],
              });
              return;
            }

            if (!needsTriage && hasTriage) {
              await github.rest.issues.removeLabel({
                ...params,
                name: triageLabel,
              });
            }
